module subqueries

language pgql-lang

test Aggregation in subquery and referencing variable from outer query outside of aggregation (1) [[

  SELECT n
   MATCH (n)
   WHERE EXISTS ( SELECT COUNT(*) AS cnt, [[n]]
                   MATCH (m)
                )

]] error like "Aggregation expected here since SELECT has other aggregation" at #1

test Aggregation in subquery and referencing variable from outer query outside of aggregation (2) [[

  SELECT 123 AS x
   MATCH (n)
   WHERE EXISTS (   SELECT COUNT(*) AS cnt
                     MATCH (m)
                  ORDER BY [[n]].prop
                )

]] error like "Aggregation expected here since SELECT has aggregation" at #1

test Reference variable from outer query after GROUP BY (1) [[

    SELECT n
     MATCH (n)
     WHERE EXISTS (    SELECT m
                        MATCH (m)
                     GROUP BY m
                     ORDER BY [[n]].prop
                  )

]] error like "Can't reference variable from outer query after GROUP BY, unless from within aggregation" at #1

test Reference variable from outer query after GROUP BY (2) [[

    SELECT n
     MATCH (n)
     WHERE EXISTS (    SELECT m
                        MATCH (m)
                     GROUP BY m
                     ORDER BY [[n]].prop
                  )
  GROUP BY n

]] error like "Can't reference variable from outer query after GROUP BY, unless from within aggregation" at #1

test Reference variable from outer query after GROUP BY (3) [[

    SELECT n
     MATCH (n)
     WHERE EXISTS (    SELECT [[n]].prop AS prop
                        MATCH (m)
                     GROUP BY m
                  )
  GROUP BY n

]] error like "Can't reference variable from outer query after GROUP BY, unless from within aggregation" at #1

test Reference variable from outer query after aggregation (1) [[

  SELECT n AS x
     MATCH (n)
     WHERE EXISTS (   SELECT COUNT(*) AS cnt
                       MATCH (m)
                    ORDER BY [[x]].prop
                  )

]] error like "Can't reference variable from outer query when SELECT has aggregation, unless from within aggregation" at #1

test Reference variable from outer query after aggregation (2) [[

    SELECT n
     MATCH (n)
     WHERE EXISTS (   SELECT COUNT(*) AS cnt, [[x]].prop AS prop
                       MATCH (m)
                    ORDER BY x.prop
                  )
  GROUP BY n AS x

]] error like "Can't reference variable from outer query when SELECT has aggregation, unless from within aggregation" at #1
